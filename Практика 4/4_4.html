<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéµ –î–µ—Ç—Å–∫–∏–π –º—É–∑—ã–∫–∞–ª—å–Ω—ã–π –æ—Ä–∫–µ—Å—Ç—Ä</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Comic Sans MS', cursive, sans-serif;
            background: linear-gradient(135deg, #8E2DE2 0%, #4A00E0 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            color: white;
            overflow-x: hidden;
        }
        
        .header {
            text-align: center;
            margin-bottom: 20px;
            width: 100%;
            max-width: 1000px;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 3px 3px 0 rgba(0,0,0,0.2);
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 15px;
        }
        
        .instructions {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
            font-size: 1rem;
            max-width: 800px;
        }
        
        .orchestra-container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 15px 30px rgba(0,0,0,0.3);
            width: 100%;
            max-width: 1000px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .instruments-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .instrument-btn {
            background: rgba(255, 255, 255, 0.15);
            border: none;
            border-radius: 15px;
            padding: 20px 15px;
            color: white;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .instrument-btn:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-5px);
        }
        
        .instrument-btn.active {
            background: rgba(255, 215, 0, 0.3);
            transform: scale(1.05);
            box-shadow: 0 8px 20px rgba(255, 215, 0, 0.3);
        }
        
        .instrument-icon {
            font-size: 3rem;
        }
        
        .instrument-name {
            font-size: 1.1rem;
        }
        
        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 10px;
        }
        
        .control-btn {
            padding: 15px 30px;
            border: none;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .play-btn {
            background: #2ecc71;
            color: white;
        }
        
        .play-btn:hover {
            background: #27ae60;
            transform: translateY(-3px);
        }
        
        .stop-btn {
            background: #e74c3c;
            color: white;
        }
        
        .stop-btn:hover {
            background: #c0392b;
            transform: translateY(-3px);
        }
        
        .melody-btn {
            background: #3498db;
            color: white;
        }
        
        .melody-btn:hover {
            background: #2980b9;
            transform: translateY(-3px);
        }
        
        .volume-control {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-top: 15px;
            justify-content: center;
        }
        
        .volume-slider {
            width: 200px;
            height: 10px;
            -webkit-appearance: none;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 5px;
            outline: none;
        }
        
        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #FFD166;
            cursor: pointer;
        }
        
        .active-instruments {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 15px;
            margin-top: 10px;
            text-align: center;
        }
        
        .active-title {
            font-size: 1.2rem;
            margin-bottom: 10px;
            color: #FFD166;
        }
        
        .active-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }
        
        .active-item {
            background: rgba(255, 215, 0, 0.2);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
        }
        
        .visualizer {
            height: 100px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            margin-top: 20px;
            overflow: hidden;
            position: relative;
        }
        
        .visualizer-bar {
            position: absolute;
            bottom: 0;
            width: 10px;
            background: #FFD166;
            border-radius: 5px 5px 0 0;
            transition: height 0.1s;
        }
        
        .footer {
            margin-top: 20px;
            text-align: center;
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
        }
        
        @media (max-width: 768px) {
            .instruments-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
            }
            
            .control-btn {
                width: 100%;
                max-width: 300px;
                justify-content: center;
            }
        }
        
        @media (max-width: 480px) {
            .instruments-grid {
                grid-template-columns: 1fr;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            .instrument-btn {
                padding: 15px 10px;
            }
            
            .instrument-icon {
                font-size: 2.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üéµ –î–µ—Ç—Å–∫–∏–π –º—É–∑—ã–∫–∞–ª—å–Ω—ã–π –æ—Ä–∫–µ—Å—Ç—Ä</h1>
        <p class="subtitle">–°–æ–∑–¥–∞–≤–∞–π –º—É–∑—ã–∫—É, –≤–∫–ª—é—á–∞—è –∏ –≤—ã–∫–ª—é—á–∞—è —Ä–∞–∑–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã!</p>
        
        <div class="instructions">
            <p>üéπ –ù–∞–∂–∏–º–∞–π –Ω–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã, —á—Ç–æ–±—ã –≤–∫–ª—é—á–∏—Ç—å –∏–ª–∏ –≤—ã–∫–ª—é—á–∏—Ç—å –∏—Ö</p>
            <p>üéº –ù–∞–∂–º–∏ "–ò–≥—Ä–∞—Ç—å", —á—Ç–æ–±—ã —É—Å–ª—ã—à–∞—Ç—å —Å–≤–æ—é –º–µ–ª–æ–¥–∏—é</p>
            <p>‚≠ê –ü–æ–ø—Ä–æ–±—É–π —Ä–∞–∑–Ω—ã–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤!</p>
        </div>
    </div>
    
    <div class="orchestra-container">
        <div class="instruments-grid" id="instrumentsGrid">
            <!-- –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
        </div>
        
        <div class="active-instruments">
            <div class="active-title">üé∂ –ê–∫—Ç–∏–≤–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:</div>
            <div class="active-list" id="activeInstruments">
                <div class="active-item">–ü–æ–∫–∞ –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤</div>
            </div>
        </div>
        
        <div class="controls">
            <button class="control-btn play-btn" id="playBtn">
                ‚ñ∂Ô∏è –ò–≥—Ä–∞—Ç—å
            </button>
            <button class="control-btn stop-btn" id="stopBtn">
                ‚èπÔ∏è –°—Ç–æ–ø
            </button>
            <button class="control-btn melody-btn" id="melodyBtn">
                üéµ –°–ª—É—á–∞–π–Ω–∞—è –º–µ–ª–æ–¥–∏—è
            </button>
        </div>
        
        <div class="volume-control">
            <span>üîä –ì—Ä–æ–º–∫–æ—Å—Ç—å:</span>
            <input type="range" min="0" max="100" value="70" class="volume-slider" id="volumeSlider">
        </div>
        
        <div class="visualizer" id="visualizer">
            <!-- –í–∏–∑—É–∞–ª–∏–∑–∞—Ç–æ—Ä –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω —á–µ—Ä–µ–∑ JavaScript -->
        </div>
    </div>
    
    <div class="footer">
        <p>–í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –º—É–∑—ã–∫–∞–ª—å–Ω—ã–π –æ—Ä–∫–µ—Å—Ç—Ä –¥–ª—è –¥–µ—Ç–µ–π ‚Ä¢ –°–æ–∑–¥–∞–≤–∞–π —Å–≤–æ–∏ –º–µ–ª–æ–¥–∏–∏!</p>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞—É–¥–∏–æ–∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        
        // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
        const instrumentsGrid = document.getElementById('instrumentsGrid');
        const activeInstruments = document.getElementById('activeInstruments');
        const playBtn = document.getElementById('playBtn');
        const stopBtn = document.getElementById('stopBtn');
        const melodyBtn = document.getElementById('melodyBtn');
        const volumeSlider = document.getElementById('volumeSlider');
        const visualizer = document.getElementById('visualizer');
        
        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–≥—Ä—ã
        let activeInstrumentsList = [];
        let isPlaying = false;
        let currentOscillators = [];
        let masterGainNode = audioContext.createGain();
        
        // –ü–æ–¥–∫–ª—é—á–∞–µ–º –º–∞—Å—Ç–µ—Ä-–≥–µ–π–Ω –∫ –≤—ã—Ö–æ–¥—É
        masterGainNode.connect(audioContext.destination);
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≥—Ä–æ–º–∫–æ—Å—Ç–∏
        volumeSlider.addEventListener('input', () => {
            const volume = volumeSlider.value / 100;
            masterGainNode.gain.setValueAtTime(volume, audioContext.currentTime);
        });
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≥—Ä–æ–º–∫–æ—Å—Ç–∏
        masterGainNode.gain.setValueAtTime(volumeSlider.value / 100, audioContext.currentTime);
        
        // –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –æ—Ä–∫–µ—Å—Ç—Ä–∞
        const instruments = [
            {
                id: 'piano',
                name: '–ü–∏–∞–Ω–∏–Ω–æ',
                emoji: 'üéπ',
                type: 'sine',
                baseFreq: 261.63, // C4
                harmonics: [1, 0.5, 0.25]
            },
            {
                id: 'guitar',
                name: '–ì–∏—Ç–∞—Ä–∞',
                emoji: 'üé∏',
                type: 'sawtooth',
                baseFreq: 196.00, // G3
                harmonics: [1, 0.7, 0.3, 0.1]
            },
            {
                id: 'violin',
                name: '–°–∫—Ä–∏–ø–∫–∞',
                emoji: 'üéª',
                type: 'sine',
                baseFreq: 329.63, // E4
                harmonics: [1, 0.8, 0.6, 0.4]
            },
            {
                id: 'trumpet',
                name: '–¢—Ä—É–±–∞',
                emoji: 'üé∫',
                type: 'square',
                baseFreq: 233.08, // Bb3
                harmonics: [1, 0.9, 0.7, 0.5]
            },
            {
                id: 'flute',
                name: '–§–ª–µ–π—Ç–∞',
                emoji: 'üé∂', // –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π —ç–º–æ–¥–∑–∏ –¥–ª—è —Ñ–ª–µ–π—Ç—ã
                type: 'sine',
                baseFreq: 349.23, // F4
                harmonics: [1, 0.3, 0.1]
            },
            {
                id: 'drum',
                name: '–ë–∞—Ä–∞–±–∞–Ω',
                emoji: 'ü•Å',
                type: 'noise',
                baseFreq: 100,
                harmonics: []
            },
            {
                id: 'xylophone',
                name: '–ö—Å–∏–ª–æ—Ñ–æ–Ω',
                emoji: 'üéº',
                type: 'triangle',
                baseFreq: 523.25, // C5
                harmonics: [1, 0.6, 0.3]
            },
            {
                id: 'harp',
                name: '–ê—Ä—Ñ–∞',
                emoji: 'üéµ',
                type: 'sine',
                baseFreq: 392.00, // G4
                harmonics: [1, 0.8, 0.6, 0.4, 0.2]
            }
        ];
        
        // –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ç–æ—Ä–∞
        function createVisualizer() {
            visualizer.innerHTML = '';
            const barCount = 20;
            for (let i = 0; i < barCount; i++) {
                const bar = document.createElement('div');
                bar.className = 'visualizer-bar';
                bar.style.left = `${(i / barCount) * 100}%`;
                bar.style.height = '0px';
                visualizer.appendChild(bar);
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ç–æ—Ä–∞
        function updateVisualizer() {
            if (!isPlaying) return;
            
            const bars = document.querySelectorAll('.visualizer-bar');
            bars.forEach((bar, index) => {
                const height = 10 + Math.random() * 90;
                bar.style.height = `${height}px`;
                bar.style.backgroundColor = `hsl(${index * 18}, 100%, 65%)`;
            });
            
            requestAnimationFrame(updateVisualizer);
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
        function createInstruments() {
            instruments.forEach(instrument => {
                const instrumentBtn = document.createElement('button');
                instrumentBtn.className = 'instrument-btn';
                instrumentBtn.dataset.id = instrument.id;
                instrumentBtn.innerHTML = `
                    <div class="instrument-icon">${instrument.emoji}</div>
                    <div class="instrument-name">${instrument.name}</div>
                `;
                
                instrumentBtn.addEventListener('click', () => {
                    toggleInstrument(instrument.id);
                });
                
                instrumentsGrid.appendChild(instrumentBtn);
            });
        }
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞
        function toggleInstrument(instrumentId) {
            const instrumentBtn = document.querySelector(`[data-id="${instrumentId}"]`);
            const instrument = instruments.find(inst => inst.id === instrumentId);
            
            if (activeInstrumentsList.includes(instrumentId)) {
                // –í—ã–∫–ª—é—á–∞–µ–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç
                activeInstrumentsList = activeInstrumentsList.filter(id => id !== instrumentId);
                instrumentBtn.classList.remove('active');
            } else {
                // –í–∫–ª—é—á–∞–µ–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç
                activeInstrumentsList.push(instrumentId);
                instrumentBtn.classList.add('active');
                
                // –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º –∫–æ—Ä–æ—Ç–∫–∏–π –∑–≤—É–∫ –ø—Ä–∏ –≤–∫–ª—é—á–µ–Ω–∏–∏
                playInstrumentSound(instrument, 0.5);
            }
            
            updateActiveInstrumentsDisplay();
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∞–∫—Ç–∏–≤–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
        function updateActiveInstrumentsDisplay() {
            activeInstruments.innerHTML = '';
            
            if (activeInstrumentsList.length === 0) {
                activeInstruments.innerHTML = '<div class="active-item">–ü–æ–∫–∞ –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤</div>';
                return;
            }
            
            activeInstrumentsList.forEach(instrumentId => {
                const instrument = instruments.find(inst => inst.id === instrumentId);
                const activeItem = document.createElement('div');
                activeItem.className = 'active-item';
                activeItem.textContent = instrument.name;
                activeInstruments.appendChild(activeItem);
            });
        }
        
        // –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–≤—É–∫–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞
        function playInstrumentSound(instrument, duration = 2) {
            if (audioContext.state === 'suspended') {
                audioContext.resume();
            }
            
            if (instrument.type === 'noise') {
                // –û—Å–æ–±—ã–π —Å–ª—É—á–∞–π –¥–ª—è –±–∞—Ä–∞–±–∞–Ω–∞/—à—É–º–∞
                playDrumSound();
                return;
            }
            
            // –°–æ–∑–¥–∞–µ–º –æ—Å—Ü–∏–ª–ª—è—Ç–æ—Ä—ã –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ç–æ–Ω–∞ –∏ –≥–∞—Ä–º–æ–Ω–∏–∫
            const oscillators = [];
            
            // –û—Å–Ω–æ–≤–Ω–æ–π –æ—Å—Ü–∏–ª–ª—è—Ç–æ—Ä
            const mainOscillator = audioContext.createOscillator();
            const mainGain = audioContext.createGain();
            
            mainOscillator.connect(mainGain);
            mainGain.connect(masterGainNode);
            
            mainOscillator.type = instrument.type;
            mainOscillator.frequency.setValueAtTime(instrument.baseFreq, audioContext.currentTime);
            
            mainGain.gain.setValueAtTime(0.3, audioContext.currentTime);
            mainGain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
            
            mainOscillator.start(audioContext.currentTime);
            mainOscillator.stop(audioContext.currentTime + duration);
            
            oscillators.push(mainOscillator);
            
            // –ì–∞—Ä–º–æ–Ω–∏–∫–∏
            instrument.harmonics.forEach((harmonic, index) => {
                const harmonicOscillator = audioContext.createOscillator();
                const harmonicGain = audioContext.createGain();
                
                harmonicOscillator.connect(harmonicGain);
                harmonicGain.connect(masterGainNode);
                
                harmonicOscillator.type = instrument.type;
                harmonicOscillator.frequency.setValueAtTime(
                    instrument.baseFreq * (index + 2), 
                    audioContext.currentTime
                );
                
                harmonicGain.gain.setValueAtTime(0.3 * harmonic, audioContext.currentTime);
                harmonicGain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
                
                harmonicOscillator.start(audioContext.currentTime);
                harmonicOscillator.stop(audioContext.currentTime + duration);
                
                oscillators.push(harmonicOscillator);
            });
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Å—Ü–∏–ª–ª—è—Ç–æ—Ä—ã –¥–ª—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏
            currentOscillators.push(...oscillators);
            
            // –£–¥–∞–ª—è–µ–º –æ—Å—Ü–∏–ª–ª—è—Ç–æ—Ä—ã –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
            setTimeout(() => {
                oscillators.forEach(osc => {
                    const index = currentOscillators.indexOf(osc);
                    if (index > -1) {
                        currentOscillators.splice(index, 1);
                    }
                });
            }, duration * 1000);
        }
        
        // –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–≤—É–∫–∞ –±–∞—Ä–∞–±–∞–Ω–∞
        function playDrumSound() {
            const bufferSize = audioContext.sampleRate * 0.5;
            const buffer = audioContext.createBuffer(1, bufferSize, audioContext.sampleRate);
            const data = buffer.getChannelData(0);
            
            for (let i = 0; i < bufferSize; i++) {
                data[i] = Math.random() * 2 - 1;
            }
            
            const noise = audioContext.createBufferSource();
            const noiseGain = audioContext.createGain();
            
            noise.buffer = buffer;
            noise.connect(noiseGain);
            noiseGain.connect(masterGainNode);
            
            noiseGain.gain.setValueAtTime(0.5, audioContext.currentTime);
            noiseGain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
            
            noise.start(audioContext.currentTime);
            noise.stop(audioContext.currentTime + 0.5);
            
            currentOscillators.push(noise);
            
            setTimeout(() => {
                const index = currentOscillators.indexOf(noise);
                if (index > -1) {
                    currentOscillators.splice(index, 1);
                }
            }, 500);
        }
        
        // –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –º–µ–ª–æ–¥–∏–∏
        function playMelody() {
            if (isPlaying) return;
            
            isPlaying = true;
            playBtn.disabled = true;
            createVisualizer();
            updateVisualizer();
            
            // –ü—Ä–æ—Å—Ç–∞—è –º–µ–ª–æ–¥–∏—è –∏–∑ 4 –Ω–æ—Ç
            const melodyNotes = [0, 2, 4, 5]; // C, D, E, F
            
            let noteIndex = 0;
            
            function playNextNote() {
                if (!isPlaying || activeInstrumentsList.length === 0) {
                    stopMelody();
                    return;
                }
                
                // –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º —Ç–µ–∫—É—â—É—é –Ω–æ—Ç—É –Ω–∞ –≤—Å–µ—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞—Ö
                activeInstrumentsList.forEach(instrumentId => {
                    const instrument = instruments.find(inst => inst.id === instrumentId);
                    const noteFreq = instrument.baseFreq * Math.pow(2, melodyNotes[noteIndex] / 12);
                    
                    // –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—É—é –∫–æ–ø–∏—é –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ —Å –∏–∑–º–µ–Ω–µ–Ω–Ω–æ–π —á–∞—Å—Ç–æ—Ç–æ–π
                    const tempInstrument = {...instrument, baseFreq: noteFreq};
                    playInstrumentSound(tempInstrument, 0.8);
                });
                
                noteIndex = (noteIndex + 1) % melodyNotes.length;
                
                // –ü–ª–∞–Ω–∏—Ä—É–µ–º —Å–ª–µ–¥—É—é—â—É—é –Ω–æ—Ç—É
                setTimeout(playNextNote, 800);
            }
            
            playNextNote();
        }
        
        // –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –º–µ–ª–æ–¥–∏–∏
        function stopMelody() {
            isPlaying = false;
            playBtn.disabled = false;
            
            // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å–µ –æ—Å—Ü–∏–ª–ª—è—Ç–æ—Ä—ã
            currentOscillators.forEach(oscillator => {
                try {
                    oscillator.stop();
                } catch(e) {
                    // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏, –µ—Å–ª–∏ –æ—Å—Ü–∏–ª–ª—è—Ç–æ—Ä —É–∂–µ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
                }
            });
            
            currentOscillators = [];
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤–∏–∑—É–∞–ª–∏–∑–∞—Ç–æ—Ä
            const bars = document.querySelectorAll('.visualizer-bar');
            bars.forEach(bar => {
                bar.style.height = '0px';
            });
        }
        
        // –°–ª—É—á–∞–π–Ω–∞—è –º–µ–ª–æ–¥–∏—è
        function playRandomMelody() {
            // –û—á–∏—â–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã
            activeInstrumentsList.forEach(instrumentId => {
                const instrumentBtn = document.querySelector(`[data-id="${instrumentId}"]`);
                instrumentBtn.classList.remove('active');
            });
            
            // –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã (–æ—Ç 2 –¥–æ 4)
            activeInstrumentsList = [];
            const randomCount = Math.floor(Math.random() * 3) + 2;
            
            for (let i = 0; i < randomCount; i++) {
                let randomInstrument;
                do {
                    randomInstrument = instruments[Math.floor(Math.random() * instruments.length)];
                } while (activeInstrumentsList.includes(randomInstrument.id));
                
                activeInstrumentsList.push(randomInstrument.id);
                const instrumentBtn = document.querySelector(`[data-id="${randomInstrument.id}"]`);
                instrumentBtn.classList.add('active');
            }
            
            updateActiveInstrumentsDisplay();
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –º–µ–ª–æ–¥–∏—é
            playMelody();
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
        playBtn.addEventListener('click', playMelody);
        stopBtn.addEventListener('click', stopMelody);
        melodyBtn.addEventListener('click', playRandomMelody);
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        createInstruments();
        createVisualizer();
        updateActiveInstrumentsDisplay();
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∫–ª–∏–∫–µ (–¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤)
        document.addEventListener('click', function initAudio() {
            if (audioContext.state === 'suspended') {
                audioContext.resume();
            }
            document.removeEventListener('click', initAudio);
        });
    </script>
</body>
</html>